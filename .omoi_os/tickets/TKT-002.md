---
id: TKT-002
title: Notification API Endpoints
status: backlog
priority: HIGH
estimate: M
design_ref: designs/notification-system.md
requirements:
  - REQ-NOTIF-FUNC-003
  - REQ-NOTIF-FUNC-004
  - REQ-NOTIF-FUNC-005
  - REQ-NOTIF-FUNC-012
dependencies:
  blocked_by:
    - TKT-001
  blocks: []
---

# TKT-002: Notification API Endpoints

## Description

Implement REST API endpoints for clients to interact with notifications, including listing notifications, marking as read, deleting notifications, and getting unread counts.

## Scope

### In Scope
- GET /api/v1/notifications - List user notifications with pagination
- PATCH /api/v1/notifications/{id}/read - Mark single notification as read
- POST /api/v1/notifications/read-all - Mark all notifications as read
- DELETE /api/v1/notifications/{id} - Delete a notification
- GET /api/v1/notifications/unread-count - Get unread count
- WebSocket integration for real-time delivery

### Out of Scope
- Preferences endpoints (covered in TKT-003)
- Email delivery (covered in TKT-004)
- Frontend UI components

## Acceptance Criteria

- [ ] GET /api/v1/notifications returns paginated notifications ordered by created_at DESC
- [ ] Query parameters: status (all|read|unread), type, limit (1-100), offset
- [ ] Response includes unread_count in headers or body
- [ ] PATCH /api/v1/notifications/{id}/read updates status and read_at timestamp
- [ ] POST /api/v1/notifications/read-all updates all unread notifications in single transaction
- [ ] DELETE /api/v1/notifications/{id} soft-deletes notification
- [ ] All endpoints require valid JWT authentication
- [ ] Users can only access their own notifications (403 for cross-user access)
- [ ] WebSocket broadcasts notification_new event on creation
- [ ] WebSocket broadcasts notification_read event on mark as read
- [ ] All endpoints have integration tests

## Technical Notes

- Use FastAPI router at /api/v1/notifications
- Leverage existing WebSocketManager from omoi_os.api.routes.events
- Pagination uses offset/limit (consider cursor pagination for future)
- Authentication via existing get_current_user dependency

## Tasks

- TSK-010: Create notification router with list endpoint
- TSK-011: Implement mark as read endpoint
- TSK-012: Implement mark all as read endpoint
- TSK-013: Implement delete endpoint
- TSK-014: Implement unread count endpoint
- TSK-015: Add WebSocket broadcasting to NotificationService
- TSK-016: Write integration tests for all endpoints

## Dependencies

**Blocked By**: TKT-001 (requires NotificationService and models)
**Blocks**: None

## Estimate

**Size**: M (2-4 hours)
**Rationale**: Straightforward CRUD endpoints with WebSocket integration. Most complexity is in pagination and filtering.
