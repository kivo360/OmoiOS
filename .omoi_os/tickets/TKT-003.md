---
id: TKT-003
title: Notification Preferences Management
status: backlog
priority: MEDIUM
estimate: M
design_ref: designs/notification-system.md
requirements:
  - REQ-NOTIF-FUNC-007
  - REQ-NOTIF-FUNC-011
dependencies:
  blocked_by:
    - TKT-001
  blocks: []
---

# TKT-003: Notification Preferences Management

## Description

Implement user and organization-level notification preferences, allowing users to control which notification types they receive and through which channels (in-app, email).

## Scope

### In Scope
- GET /api/v1/notifications/preferences - Get user preferences
- PUT /api/v1/notifications/preferences - Update user preferences
- GET /api/v1/organizations/{id}/notification-preferences - Get org defaults (admin only)
- PUT /api/v1/organizations/{id}/notification-preferences - Update org defaults (admin only)
- Preference validation against allowed notification types
- Default preferences for new users

### Out of Scope
- Frontend preference UI
- Preference templates

## Acceptance Criteria

- [ ] User preferences control in_app and email channels per notification type
- [ ] Organization preferences provide defaults for new members
- [ ] User preferences override organization preferences
- [ ] Preferences are validated against allowed notification types
- [ ] New users get default preferences (all in-app enabled, email disabled)
- [ ] New organization members inherit org defaults
- [ ] Only organization admins can modify org preferences
- [ ] Preferences are checked before creating notifications
- [ ] API returns current preferences on GET
- [ ] API validates preference updates on PUT

## Technical Notes

- Preferences stored as JSONB for flexibility
- Default preferences defined in constants
- Preference validation uses NotificationType enum
- Admin check via existing authorization service

## Tasks

- TSK-017: Create NotificationPreferenceService
- TSK-018: Implement user preferences API endpoints
- TSK-019: Implement organization preferences API endpoints
- TSK-020: Add default preferences for new users
- TSK-021: Write tests for preference management

## Dependencies

**Blocked By**: TKT-001 (requires NotificationPreference model)
**Blocks**: None

## Estimate

**Size**: M (2-4 hours)
**Rationale**: Preference management is straightforward CRUD with validation. Main complexity is organization/user inheritance logic.

## Tasks

- TSK-017: Create NotificationPreferenceService
- TSK-018: Implement user preferences API endpoints
- TSK-019: Implement organization preferences API endpoints
- TSK-020: Add default preferences for new users
- TSK-021: Write tests for preference management
