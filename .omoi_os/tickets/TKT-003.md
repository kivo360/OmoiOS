---
id: TKT-003
title: Consolidation API Endpoints
status: backlog
priority: HIGH
estimate: M
design_ref: designs/memory-consolidation.md
requirements:
  - REQ-MEMCONS-FUNC-007
  - REQ-MEMCONS-FUNC-008
  - REQ-MEMCONS-FUNC-009
  - REQ-MEMCONS-FUNC-010
dependencies:
  blocked_by: [TKT-001, TKT-002]
  blocks: []
---

# TKT-003: Consolidation API Endpoints

## Description

Create FastAPI endpoints for the consolidation system including manual trigger, status query, history retrieval, and rollback functionality.

## Scope

### In Scope
- POST /api/v1/consolidation/trigger - Manual consolidation trigger
- GET /api/v1/consolidation/status/{job_id} - Job status query
- GET /api/v1/consolidation/history/{project_id} - Consolidation history
- POST /api/v1/consolidation/rollback - Rollback consolidation
- GET /api/v1/consolidation/configure/{project_id} - Get/set config

### Out of Scope
- Scheduled job execution (covered in TKT-004)
- UI components

## Acceptance Criteria

- [ ] POST /trigger endpoint with request validation
- [ ] Returns 202 Accepted with job_id
- [ ] GET /status/{job_id} returns job progress and results
- [ ] GET /history/{project_id} with pagination
- [ ] POST /rollback with validation (7-day window)
- [ ] All endpoints require admin authentication
- [ ] Error responses with proper status codes
- [ ] OpenAPI documentation complete
- [ ] Integration tests for all endpoints

## Technical Notes

### Authentication
- JWT token required
- Admin role check
- Project access validation

### Async Execution
- Consolidation runs in background (Celery task)
- Returns immediately with job_id
- Status endpoint polls for progress

### Rollback Validation
- Check consolidation exists
- Verify within 7-day window
- Check for conflicting changes
- Restore using audit trail

## Dependencies

**Blocked By**: TKT-001 (Database), TKT-002 (Service)
**Blocks**: None

## Estimate

**Size**: M (2-4 hours)
**Rationale**: Standard CRUD API with async job pattern

## Tasks

- TSK-015: Create API router for consolidation endpoints
- TSK-016: Implement POST /trigger endpoint
- TSK-017: Implement GET /status endpoint
- TSK-018: Implement GET /history endpoint
- TSK-019: Implement POST /rollback endpoint
- TSK-020: Add authentication and authorization
- TSK-021: Write API integration tests
