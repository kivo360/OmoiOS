---
id: TKT-001
title: Supervisor Core Service Implementation
status: backlog
priority: HIGH
estimate: L
design_ref: designs/supervisor-agent.md
requirements:
  - REQ-SUPERVISOR-FUNC-001
  - REQ-SUPERVISOR-FUNC-002
  - REQ-SUPERVISOR-FUNC-009
dependencies:
  blocked_by: []
  blocks: [TKT-002, TKT-004]
---

# TKT-001: Supervisor Core Service Implementation

## Description

Implement the core SupervisorAgent service including lifecycle management, team assignment, and health monitoring. This is the foundation for all supervisor functionality.

## Scope

### In Scope
- SupervisorAgent core service class
- Database models for supervisors, teams, and team members
- Supervisor lifecycle (create, start, pause, resume, stop, delete)
- Team creation and agent assignment
- Supervisor health monitoring and heartbeats
- Basic API endpoints for supervisor management

### Out of Scope
- Policy engine (covered in TKT-002)
- Hierarchical supervision (covered in TKT-004)
- Intervention orchestration (covered in TKT-002)

## Acceptance Criteria

- [ ] SupervisorAgent service class with start/stop lifecycle
- [ ] Database migration creates all supervisor tables
- [ ] Supervisor can be created via POST /api/v1/supervisors
- [ ] Supervisor emits heartbeats every 30 seconds
- [ ] Supervisors with >3 missed heartbeats marked UNRESPONSIVE
- [ ] Teams can be created and agents assigned via API
- [ ] Supervisor health is queryable via GET /api/v1/supervisors/{id}/health
- [ ] Unit tests for lifecycle, team management, health monitoring
- [ ] Integration tests for API endpoints

## Technical Notes

### Files to Create
- `backend/omoi_os/models/supervisor.py` - SQLAlchemy models
- `backend/omoi_os/services/supervisor_agent.py` - SupervisorAgent service
- `backend/omoi_os/services/team_manager.py` - Team management service
- `backend/omoi_os/api/routes/supervisors.py` - FastAPI routes
- `backend/migrations/versions/XXX_supervisor_tables.py` - Database migration

### Key Implementation Details
- Supervisor status follows state machine: SPAWNING → ACTIVE → PAUSED/FAILED → TERMINATED
- Heartbeats update `supervisors.last_heartbeat` timestamp
- Health check queries agents with heartbeats within last 90 seconds
- Team membership tracked with `joined_at` and `left_at` timestamps

### Database Schema
See `designs/supervisor-agent.md` for complete schema. Key tables:
- `supervisors` - Supervisor instances
- `supervisor_teams` - Team definitions
- `supervisor_team_members` - Agent-team memberships

## Tasks

- TSK-001: Create supervisor database models and migration
- TSK-002: Implement TeamManager service
- TSK-003: Implement SupervisorAgent core service
- TSK-004: Implement supervisor health monitoring
- TSK-005: Create supervisor API routes
- TSK-006: Write tests for supervisor core service

## Dependencies

**Blocked By**: None
**Blocks**: TKT-002 (Policy Engine), TKT-004 (Hierarchy Management)

## Estimate

**Size**: L (4-8 hours)
**Rationale**: Multiple services to implement, database migration, API routes, and comprehensive tests
