---
id: TSK-019
title: Implement organization preferences API endpoints
status: pending
parent_ticket: TKT-003
estimate: M
type: implementation
dependencies:
  depends_on:
    - TSK-017
  blocks: []
---

# TSK-019: Implement organization preferences API endpoints

## Objective

Implement GET and PUT endpoints for organization notification preferences (admin only).

## Context

Organization admins need to set default notification preferences for organization members.

## Deliverables

- [ ] Add organization preferences endpoints to router

## Implementation Notes

```python
from omoi_os.api.dependencies import require_organization_admin

@router.get("/organizations/{organization_id}/notification-preferences", response_model=NotificationPreferencesResponse)
async def get_organization_preferences(
    organization_id: UUID,
    current_user: User = Depends(get_current_user),
    pref_service: NotificationPreferenceService = Depends(get_preference_service),
):
    """Get organization default notification preferences."""
    # Verify user is member/admin of org
    # ...

    preferences = await pref_service.get_organization_preferences(organization_id)
    return NotificationPreferencesResponse(
        organization_id=organization_id,
        preferences=preferences,
    )

@router.put("/organizations/{organization_id}/notification-preferences", response_model=NotificationPreferencesResponse)
async def update_organization_preferences(
    organization_id: UUID,
    update: NotificationPreferencesUpdate,
    current_user: User = Depends(require_organization_admin),
    pref_service: NotificationPreferenceService = Depends(get_preference_service),
):
    """Update organization default notification preferences (admin only)."""
    # Get current preferences
    current = await pref_service.get_organization_preferences(organization_id)

    # Merge updates
    if update.in_app is not None:
        current.in_app = {**current.in_app, **update.in_app}
    if update.email is not None:
        current.email = {**current.email, **update.email}

    # Save
    await pref_service.update_organization_preferences(organization_id, current)

    return NotificationPreferencesResponse(
        organization_id=organization_id,
        preferences=current,
    )
```

## Acceptance Criteria

- [ ] GET /api/v1/organizations/{id}/notification-preferences returns org defaults
- [ ] PUT /api/v1/organizations/{id}/notification-preferences updates org defaults
- [ ] PUT endpoint requires organization admin role
- [ ] Non-admin requests return 403 Forbidden
- [ ] Organization defaults inherited by new members
