---
id: TSK-024
title: Configure Celery beat schedule
status: pending
ticket_id: TKT-004
estimate: S
type: implementation
dependencies:
  depends_on: [TSK-022]
  blocks: []
---

# TSK-024: Configure Celery beat schedule

## Objective

Configure Celery beat to run the scheduled consolidation task daily.

## Context

Celery beat is the scheduler that triggers periodic tasks. We need to configure it to run consolidation daily.

## Deliverables

- Celery beat configuration in settings

## Implementation Notes

```python
# omoi_os/celery_app.py (or equivalent)
from celery.schedules import crontab

app.conf.beat_schedule = {
    'consolidation-daily': {
        'task': 'consolidation.run_scheduled',
        'schedule': crontab(hour=2, minute=0),  # 2 AM daily
        'options': {
            'expires': 3600,  # Task expires after 1 hour
        },
    },
}
```

Or using django-celery-beat if applicable:
```python
# Database model for periodic tasks
from django_celery_beat.models import PeriodicTask, IntervalSchedule

# Create schedule (one-time setup)
schedule, created = IntervalSchedule.objects.get_or_create(
    every=24,
    period=IntervalSchedule.HOURS,
)

PeriodicTask.objects.get_or_create(
    name="Daily Consolidation",
    task="consolidation.run_scheduled",
    defaults={
        'interval': schedule,
        'args': [],
    },
)
```

## Acceptance Criteria

- [ ] Celery beat configured to run daily
- [ ] Schedule configurable (hour/minute)
- [ ] Task expiration configured
- [ ] Schedule can be disabled via config
- [ ] Tests for schedule registration

## Dependencies

**Depends On**: TSK-022
**Blocks**: None

## Estimate

**Size**: S (< 2 hours)
