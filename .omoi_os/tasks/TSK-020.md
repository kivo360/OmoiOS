---
id: TSK-020
title: Add authentication and authorization
status: pending
ticket_id: TKT-003
estimate: S
type: implementation
dependencies:
  depends_on: [TSK-016, TSK-017, TSK-018, TSK-019]
  blocks: []
---

# TSK-020: Add authentication and authorization

## Objective

Ensure all consolidation endpoints have proper authentication and admin-level authorization.

## Context

Consolidation operations are sensitive and require admin access. All endpoints should validate JWT tokens and check user permissions.

## Deliverables

- Authentication/authorization integrated into all consolidation endpoints

## Implementation Notes

The authentication should use the existing `get_current_admin_user` dependency from the auth system.

```python
# Verify existing auth dependency
from omoi_os.api.dependencies import get_current_admin_user

# Apply to all endpoints
@router.post("/trigger", ...)
async def trigger_consolidation(
    ...,
    current_user = Depends(get_current_admin_user),  # This handles auth + admin check
    ...
):
```

## Acceptance Criteria

- [ ] All endpoints use `get_current_admin_user` dependency
- [ ] 401 returned for missing/invalid tokens
- [ ] 403 returned for non-admin users
- [ ] Project access validation for project-specific operations
- [ ] Tests for auth scenarios

## Dependencies

**Depends On**: TSK-016, TSK-017, TSK-018, TSK-019
**Blocks**: None

## Estimate

**Size**: S (< 2 hours)
