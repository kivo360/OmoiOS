---
id: TSK-020
title: Add default preferences for new users
status: pending
parent_ticket: TKT-003
estimate: S
type: implementation
dependencies:
  depends_on:
    - TSK-017
  blocks: []
---

# TSK-020: Add default preferences for new users

## Objective

Ensure new users get default notification preferences when they register.

## Context

New users should have sensible default preferences so they receive important notifications.

## Deliverables

- [ ] Update user registration flow to create default preferences

## Implementation Notes

```python
# In user registration service or after user creation

from omoi_os.services.notification_preference_service import NotificationPreferenceService, DEFAULT_PREFERENCES

async def create_user_with_defaults(
    db: AsyncSession,
    email: str,
    full_name: str,
    password: str,
    organization_id: Optional[UUID] = None,
) -> User:
    """Create user with default notification preferences."""
    # Create user
    user = User(
        email=email,
        full_name=full_name,
        hashed_password=hash_password(password),
    )
    db.add(user)
    await db.flush()  # Get user.id

    # Create default preferences
    preferences = DEFAULT_PREFERENCES.copy()

    # If joining an organization, inherit org defaults
    if organization_id:
        org_prefs = await pref_service.get_organization_preferences(organization_id)
        preferences = org_prefs.model_dump()

    pref = NotificationPreference(
        user_id=user.id,
        preferences=preferences,
        organization_id=organization_id,
    )
    db.add(pref)

    await db.commit()
    await db.refresh(user)

    return user
```

## Acceptance Criteria

- [ ] New users get default preferences on registration
- [ ] Users joining organizations inherit org defaults
- [ ] Defaults can be overridden by user immediately after registration
- [ ] Preferences exist before first notification is created
