---
id: TSK-003
title: Enhance TaskMemory model with consolidation fields
status: pending
ticket_id: TKT-001
estimate: S
type: implementation
dependencies:
  depends_on:
    - TSK-001
  blocks:
    - TSK-004
---

# TSK-003: Enhance TaskMemory model with consolidation fields

## Objective

Add consolidation-related fields to the existing TaskMemory model to support memory lineage tracking.

## Context

Raw task memories need to reference their consolidated counterparts and indicate whether they have been processed by consolidation.

## Deliverables

- [ ] `backend/omoi_os/models/task_memory.py` - Enhanced with consolidation fields

## Implementation Notes

Add the following fields to the existing TaskMemory model:

```python
# backend/omoi_os/models/task_memory.py
# Add to existing imports
from typing import TYPE_CHECKING

if TYPE_CHECKING:
    from omoi_os.models.consolidated_memory import ConsolidatedMemory

class TaskMemory(Base):
    # ... existing fields ...

    # Add these new fields:
    consolidated_into_id: Mapped[Optional[str]] = mapped_column(
        String, nullable=True, index=True
    )  # References ConsolidatedMemory.id
    is_consolidated: Mapped[bool] = mapped_column(
        Boolean, nullable=False, default=False, index=True
    )

    # Update relationships if needed:
    # consolidated_into: Mapped[Optional["ConsolidatedMemory"]] = relationship(
    #     "ConsolidatedMemory",
    #     foreign_keys=[consolidated_into_id]
    # )
```

## Acceptance Criteria

- [ ] consolidated_into_id field added (String, nullable, indexed)
- [ ] is_consolidated field added (Boolean, default False, indexed)
- [ ] Fields documented with comments
- [ ] Existing model tests still pass
- [ ] Model imports without errors

## Dependencies

**Depends On**: TSK-001 (ConsolidatedMemory model for type hint)
**Blocks**: TSK-004 (Migration includes these new fields)
