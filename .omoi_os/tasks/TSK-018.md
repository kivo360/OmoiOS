---
id: TSK-018
title: Implement user preferences API endpoints
status: pending
parent_ticket: TKT-003
estimate: M
type: implementation
dependencies:
  depends_on:
    - TSK-017
  blocks: []
---

# TSK-018: Implement user preferences API endpoints

## Objective

Implement GET and PUT endpoints for user notification preferences.

## Context

Users need to view and update their notification preferences via API.

## Deliverables

- [ ] `omoi_os/api/routes/notification_preferences.py` - Preferences router (or add to notifications router)

## Implementation Notes

```python
# Add to omoi_os/api/routes/notifications.py

from omoi_os.schemas.notification import (
    NotificationPreferences,
    NotificationPreferencesResponse,
    NotificationPreferencesUpdate,
)

@router.get("/preferences", response_model=NotificationPreferencesResponse)
async def get_preferences(
    current_user: User = Depends(get_current_user),
    pref_service: NotificationPreferenceService = Depends(get_preference_service),
):
    """Get user notification preferences."""
    preferences = await pref_service.get_user_preferences(current_user.id)
    return NotificationPreferencesResponse(
        user_id=current_user.id,
        preferences=preferences,
    )

@router.put("/preferences", response_model=NotificationPreferencesResponse)
async def update_preferences(
    update: NotificationPreferencesUpdate,
    current_user: User = Depends(get_current_user),
    pref_service: NotificationPreferenceService = Depends(get_preference_service),
):
    """Update user notification preferences."""
    # Get current preferences
    current = await pref_service.get_user_preferences(current_user.id)

    # Merge updates
    if update.in_app is not None:
        current.in_app = {**current.in_app, **update.in_app}
    if update.email is not None:
        current.email = {**current.email, **update.email}

    # Save
    await pref_service.update_user_preferences(current_user.id, current)

    return NotificationPreferencesResponse(
        user_id=current_user.id,
        preferences=current,
    )
```

## Acceptance Criteria

- [ ] GET /api/v1/notifications/preferences returns current preferences
- [ ] PUT /api/v1/notifications/preferences updates preferences
- [ ] PUT merges updates with existing preferences
- [ ] Preferences validated against allowed notification types
- [ ] Only authenticated user can access their own preferences
