---
id: TSK-030
title: Write performance tests
status: pending
created: 2025-01-08
parent_ticket: TKT-005
estimate: M
type: test
dependencies:
  depends_on: [TSK-011]
  blocks: []
---

# TSK-030: Write performance tests

## Objective

Create performance tests to verify consolidation meets SLA requirements.

## Context

Requirements specify consolidation of 1000 memories should complete in under 30 seconds.

## Deliverables

- `backend/tests/performance/test_consolidation_performance.py`

## Implementation Notes

```python
# tests/performance/test_consolidation_performance.py
import pytest
import time
from omoi_os.services.consolidation.consolidation_service import ConsolidationService

@pytest.mark.performance
@pytest.mark.asyncio
async def test_consolidation_1000_memories_under_30s(db_session, project, large_memory_set):
    """Test that 1000 memories consolidate in under 30 seconds."""
    service = ConsolidationService(memory_service, embedding_service)
    options = ConsolidationOptions(merge=True, summarize=True)

    start_time = time.time()
    result = await service.execute_consolidation(
        session=db_session,
        project_id=project.id,
        options=options,
        trigger_type="manual",
        triggered_by="test",
    )
    elapsed = time.time() - start_time

    assert elapsed < 30.0, f"Consolidation took {elapsed:.2f}s, expected <30s"
    assert result.reduction_ratio > 0.3  # At least 30% reduction
```

## Acceptance Criteria

- [ ] Test with 1000 memories completes <30s
- [ ] Test with 5000 memories (if time permits)
- [ ] Memory usage monitored
- [ ] Database query count tracked
- [ ] Baseline metrics established
- [ ] All tests passing

## Dependencies

**Depends On**: TSK-011
**Blocks**: None

## Estimate

**Size**: M (2-4 hours)
