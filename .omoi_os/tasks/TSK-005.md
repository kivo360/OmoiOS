---
id: TSK-005
title: Write unit tests for models and schemas
status: pending
ticket_id: TKT-001
estimate: M
type: test
dependencies:
  depends_on: [TSK-002, TSK-003, TSK-004]
  blocks: []
---

# TSK-005: Write unit tests for models and schemas

## Objective

Create comprehensive unit tests for the new consolidation models and Pydantic schemas.

## Context

Unit tests ensure the database models and API schemas work correctly before implementing the business logic.

## Deliverables

- `backend/tests/test_consolidation_models.py` - Model unit tests
- `backend/tests/test_consolidation_schemas.py` - Schema validation tests

## Implementation Notes

```python
# tests/test_consolidation_models.py
import pytest
from omoi_os.models.consolidation_job import ConsolidationJob
from omoi_os.models.consolidation_change import ConsolidationChange

def test_create_consolidation_job(db_session):
    job = ConsolidationJob(
        project_id="test-project",
        status="pending",
        trigger_type="manual",
        triggered_by="user-123"
    )
    db_session.add(job)
    db_session.flush()

    assert job.id is not None
    assert job.status == "pending"
    assert job.memories_merged == 0

def test_consolidation_job_status_transitions(db_session):
    job = ConsolidationJob(
        project_id="test-project",
        status="pending",
        trigger_type="manual"
    )
    db_session.add(job)
    db_session.flush()

    job.status = "running"
    assert job.status == "running"

    job.status = "completed"
    assert job.status == "completed"
```

## Acceptance Criteria

- [ ] Test ConsolidationJob creation
- [ ] Test ConsolidationChange creation
- [ ] Test relationship between Job and Changes
- [ ] Test TaskMemory consolidation fields
- [ ] Test Pydantic schema validation
- [ ] Test schema field validation (ranges, constraints)
- [ ] Test schema serialization/deserialization
- [ ] All tests passing

## Dependencies

**Depends On**: TSK-002, TSK-003, TSK-004
**Blocks**: None

## Estimate

**Size**: M (2-4 hours)
