---
id: TSK-017
title: Implement GET /status endpoint
status: pending
created: 2025-01-08
parent_ticket: TKT-003
estimate: S
type: implementation
dependencies:
  depends_on: [TSK-015]
  blocks: []
---

# TSK-017: Implement GET /status endpoint

## Objective

Implement the GET /api/v1/consolidation/status/{job_id} endpoint for querying job status.

## Context

Clients need to poll for consolidation job status to track progress and get results.

## Deliverables

- GET /status/{job_id} endpoint implementation

## Implementation Notes

```python
@router.get("/status/{job_id}", response_model=ConsolidationStatusResponse)
async def get_consolidation_status(
    job_id: str,
    current_user = Depends(get_current_admin_user),
    db: Session = Depends(get_db),
):
    # Get job
    job = db.query(ConsolidationJob).filter(ConsolidationJob.id == job_id).first()
    if not job:
        raise HTTPException(status_code=404, detail="Job not found")

    # Check access
    project = db.get(Project, job.project_id)
    if not current_user.has_access(project):
        raise HTTPException(status_code=403, detail="Access denied")

    # Get consolidation changes
    changes = db.query(ConsolidationChange).filter(
        ConsolidationChange.consolidation_job_id == job_id
    ).all()

    return ConsolidationStatusResponse(
        job_id=job.id,
        project_id=job.project_id,
        status=job.status,
        progress=job.progress,
        started_at=job.started_at,
        completed_at=job.completed_at,
        memories_merged=job.memories_merged,
        memories_archived=job.memories_archived,
        memories_promoted=job.memories_promoted,
        summaries_created=job.summaries_created,
        consolidation_changes=[c.id for c in changes],
        error_message=job.error_message,
    )
```

## Acceptance Criteria

- [ ] Returns job status and progress
- [ ] Includes all result counters
- [ ] Lists consolidation change IDs
- [ ] Validates user has access to project
- [ ] Returns 404 for non-existent jobs
- [ ] Integration tests

## Dependencies

**Depends On**: TSK-015
**Blocks**: None

## Estimate

**Size**: S (< 2 hours)
