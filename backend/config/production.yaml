# Production Configuration for Railway
# Environment variables override these values

llm:
  model: openai/glm-4.7
  api_key: null  # REQUIRED: Set LLM_API_KEY env var in Railway
  base_url: https://api.z.ai/api/coding/paas/v4

database:
  # REQUIRED: Set DATABASE_URL env var in Railway
  # Use pgvector template: https://railway.com/deploy/3jJFCA
  # Then reference: DATABASE_URL=${{pgvector.DATABASE_URL}}
  url: postgresql+psycopg://postgres:postgres@localhost:15432/omoi_os

redis:
  # REQUIRED: Set REDIS_URL env var in Railway
  url: redis://localhost:16379

server:
  host: "0.0.0.0"
  port: 8000

task_queue:
  age_ceiling: 3600
  sla_urgency_window: 900
  starvation_limit: 7200
  blocker_ceiling: 10
  w_p: 0.45
  w_a: 0.2
  w_d: 0.15
  w_b: 0.15
  w_r: 0.05
  sla_boost_multiplier: 1.25
  starvation_floor_score: 0.6

approval:
  ticket_human_review: false
  approval_timeout_seconds: 1800
  on_reject: delete

auth:
  # jwt_secret_key: MUST come from AUTH_JWT_SECRET_KEY env var (Railway).
  # The app will refuse to start in production without a strong secret.
  jwt_algorithm: HS256
  access_token_expire_minutes: 15
  refresh_token_expire_days: 7
  min_password_length: 8
  require_uppercase: true
  require_lowercase: true
  require_digit: true
  require_special_char: false
  max_login_attempts: 5
  login_attempt_window_minutes: 15
  session_expire_days: 30
  # OAuth redirect - MUST match your frontend callback URL
  oauth_redirect_uri: https://omoios.dev/callback

workspace:
  root: /tmp/workspaces
  worker_dir: /tmp/omoi_os_workspaces
  mode: daytona
  docker_base_image: nikolaik/python-nodejs:python3.12-nodejs22

monitoring:
  guardian_interval_seconds: 60
  conductor_interval_seconds: 300
  health_check_interval_seconds: 30
  auto_steering_enabled: false
  max_concurrent_analyses: 5

diagnostic:
  enabled: true
  cooldown_seconds: 60
  min_stuck_time_seconds: 60
  max_agents_to_analyze: 15
  max_conductor_analyses: 5
  max_tasks_per_run: 5

worker:
  concurrency: 2

daytona:
  api_key: null  # REQUIRED: Set DAYTONA_API_KEY env var in Railway
  api_url: https://app.daytona.io/api
  target: us
  image: nikolaik/python-nodejs:python3.12-nodejs22
  snapshot: ai-agent-dev-light  # Default snapshot for sandbox creation
  timeout: 300
  # Sandbox resource limits (for preventing OOM kills)
  sandbox_memory_gb: 4  # Memory in GiB (max: 8)
  sandbox_cpu: 2  # CPU cores (max: 4)
  sandbox_disk_gb: 8  # Disk space in GiB (max: 10)

integrations:
  # MCP server URL - permanent production domain
  mcp_server_url: https://api.omoios.dev/mcp
  enable_mcp_tools: true
  github_token: null  # Set INTEGRATIONS_GITHUB_TOKEN env var in Railway

embedding:
  provider: fireworks
  fireworks_api_key: null  # REQUIRED: Set EMBEDDING_FIREWORKS_API_KEY env var in Railway
  openai_api_key: null  # Optional: Set EMBEDDING_OPENAI_API_KEY env var
  model_name: fireworks/qwen3-embedding-8b
  # Dimensions for embeddings - must be <= 2000 for pgvector standard indexing
  dimensions: 1536

observability:
  enable_tracing: true
  logfire_token: null  # Set OBSERVABILITY_LOGFIRE_TOKEN env var in Railway
